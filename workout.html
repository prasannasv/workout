<!DOCTYPE html>
<html>
  <head>
    <title>Personal Workout</title>
  </head>
  <body>
    <button id="start" onclick="startWorkout(this);">Start</button>
    <div id="workoutInfo" style="display:none">
      <h1>Workout started</h1>
      <h2 id="round" style="font-size: 6em; text-align: center"></h2>
      <h3 id="workout" style="font-size: 6em; text-align: center"></h3>
      <h3 id="timer" style="font-size: 8em; text-align: center"></h3>
    </div>
    <script lang="javascript">
        const NUM_ROUNDS = 3;
        const WORKOUT_DURATION = 30;
        const REST_BETWEEN_WORKOUTS_DURATION = 10;
        const REST_BETWEEN_ROUNDS_DURATION = 60;
        const WORKOUTS = [
          'Jumping Jacks',
          'High Knees',
          'Crunches',
          'Squats',
          'Crunch cross out stretched leg',
          'Burpees',
          'Ride side plank',
          'Left side plank',
          'Plank'
        ];
        var state;
        var tickInterval;

        function initState() {
          state = {
            round: 0,
            workout: 0,
            resting: false,
            workoutTimer: WORKOUT_DURATION,
            restTimer: REST_BETWEEN_WORKOUTS_DURATION,
          };
        }

        function startWorkout() {
          initState();

          var startButton = document.getElementById('start');
          startButton.innerText = 'Stop';
          startButton.setAttribute('onclick', 'stopWorkout();');
          document.getElementById('workoutInfo').style.display = '';

          tickInterval = setInterval(tick, 1000);
          tick();
        }

        function tick() {
          if (isDone()) {
            stopWorkout();
            return;
          }
          displayState();
          updateState();
        }

        function displayState() {
          document.getElementById('round').innerHTML = "Round " + (state.round + 1);
          if (!state.resting) {
            document.getElementById('workout').innerHTML = WORKOUTS[state.workout];
            document.getElementById('timer').innerHTML = state.workoutTimer + "s";
          } else {
            document.getElementById('workout').innerHTML = 'Rest';
            document.getElementById('timer').innerHTML = state.restTimer + "s";
          }
        }

        function updateState() {
          if (!state.resting) {
            state.workoutTimer = state.workoutTimer - 1;
          } else {
            state.restTimer = state.restTimer - 1;
          }

          if (state.workoutTimer == -1) {
            state.workoutTimer = WORKOUT_DURATION;
            state.resting = true;
            beep();
            state.workout = state.workout + 1;
            if (state.workout >= WORKOUTS.length) {
              state.workout = 0;
              state.round = state.round + 1;
              state.restTimer = REST_BETWEEN_ROUNDS_DURATION;
            }
          }

          if (state.restTimer == -1) {
            beep();
            state.resting = false;
            state.restTimer = REST_BETWEEN_WORKOUTS_DURATION;
          }
        }

        function isDone() {
          return state.round >= NUM_ROUNDS;
        }

        function stopWorkout() {
          clearWorkout();
          document.getElementById('workoutInfo').style.display = 'none';
          var startButton = document.getElementById('start');
          startButton.innerText = 'Start';
          startButton.setAttribute('onclick', 'startWorkout();');
        };

        function clearWorkout() {
          clearInterval(tickInterval);
          initState();
          document.getElementById('round').innerHTML = '';
          document.getElementById('workout').innerHTML = '';
          document.getElementById('timer').innerHTML = '';
        }

        function beep() {
          var snd = new Audio("beep.wav");
          snd.play();
        }
      </script>
    </body>
</html>
